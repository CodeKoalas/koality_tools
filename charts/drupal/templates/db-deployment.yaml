# {{- if .Values.persistence.enabled }}
# apiVersion: {{ .Values.persistence.apiVersion }}
# kind: Deployment
# metadata:
#   name: {{ template "trackabledbname" . }}
#   annotations:
#     {{ if .Values.gitlab.app }}app.gitlab.com/app: {{ .Values.gitlab.app | quote }}{{ end }}
#     {{ if .Values.gitlab.env }}app.gitlab.com/env: {{ .Values.gitlab.env | quote }}{{ end }}
#   labels:
#     app: {{ template "appname" . }}
#     track: "{{ .Values.application.track }}"
#     tier: "{{ .Values.application.tier }}"
# {{ include "sharedlabels" . | indent 4 }}
# spec:
#   replicas: {{ .Values.persistence.replicaCount }}
#   selector:
#     matchLabels:
#       app: {{ template "appname" . }}
#       track: "{{ .Values.application.track }}"
#       tier: "{{ .Values.application.tier }}"
#       release: {{ .Release.Name }}
#   template:
#     metadata:
#       annotations:
#         checksum/application-secrets: "{{ .Values.application.secretChecksum }}"
#         {{ if .Values.gitlab.app }}app.gitlab.com/app: {{ .Values.gitlab.app | quote }}{{ end }}
#         {{ if .Values.gitlab.env }}app.gitlab.com/env: {{ .Values.gitlab.env | quote }}{{ end }}
#       labels:
#         track: "{{ .Values.application.track }}"
#         tier: "{{ .Values.application.tier }}"
# {{ include "sharedlabels" . | indent 8 }}
#     spec:
#       serviceAccountName: {{ template "serviceAccountName" . }}
#       containers:
#         - name: {{ .Values.persistence.name }}
#           image: {{ .Values.persistence.image }}
#           ports:
#             - containerPort: 3306
#               protocol: TCP
#           volumeMounts:
#             - mountPath: /var/lib/mysql
#               name: "{{ template "appname" . }}-volume"
#           env:
#             - name: MARIADB_ROOT_PASSWORD
#               valueFrom:
#                 secretKeyRef:
#                   name: "production-secret"
#                   key: DATABASE_PASSWORD
#       volumes:
#         - emptyDir: {}
#           name: "{{ template "appname" . }}-volume"
# {{- end }}
