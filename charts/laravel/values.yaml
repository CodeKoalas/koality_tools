global:
  storageClass: "efs-sc"

commonLabels:

## Gitlab values for app tracking.
gitlab:
  app:
  env:
  envName:
  envURL:
  projectID:

replicaCount: 1

## Host aliases
hostAliases:
  ## Point CK registry to a private IP.
  - ip: 10.170.3.234
    hostnames:
    - "registry.codekoalas.com"
    - "gitlab.codekoalas.com"

## Service account.
serviceAccount:
  ## @param serviceAccount.create Specifies whether a service account should be created
  ##
  create: true
  ## @param serviceAccount.name The name of the service account to use. If not set and create is true, a name is generated using the fullname template
  ##
  name:
  ## @param serviceAccount.annotations Add annotations
  ##
  annotations:
    eks.amazonaws.com/role-arn: arn:aws:iam::069344082335:role/EKSManageEFS

  ## @param serviceAccount.automountServiceAccountToken Automount API credentials for a service account.
  ##
  automountServiceAccountToken: true

## Gitlab Application values.
application:
  track: stable
  tier: web
  secretName: gitlab-secret
  # Passed by Gitlab so we know when the deployment has changed.
  secretChecksum:

## The deployment application image.
image:
  repository: gitlab.example.com/group/project
  tag: stable
  pullPolicy: Always
  secrets:
    - name: gitlab-registry

## The deployment object with environment variables to use.
deployment:
  ## @param deployment.apiVersion The apiVersion to use for the deployment.
  ##
  apiVersion: apps/v1

  ## @param deployment.name The name of the deployment.
  ##
  name: gitlab-autodevops-laravel

  ## @param deployment.track The track of the deployment (stable/canary).
  ##
  track: stable

  ## @param deployment.tier The tier of the deployment (web/worker).
  ##
  tier: web

  ## @param deploymeny.appEnv The environment of the deployment (production/staging).
  ##
  appEnv: staging

  ## @param deployment.virtualHost The virtual host to use for the deployment.
  ##
  virtualHost: gitlab-autodevops-laravel.ckstage.site

  ## @param deployment.letsEncryptHost The letsEncryptHost to use for the deployment.
  ##
  letsEncryptHost: gitlab-autodevops-laravel.ckstage.site

  ## @param deployment.appUrl The appUrl to use for the deployment.
  ##
  appUrl: "https://gitlab-autodevops-laravel.ckstage.site"

  ## @param deployment.appKey The appKey to use for the deployment.
  ##
  appKey: exampleappkeygoeshere

  ## @param deployment.appDebug The will cause the DebugBar to be enabled or not.
  ##
  appDebug: false

  ## @param deployment.apacheDocroot For backwards compatibility for Apache based images.
  ##
  apacheDocroot: /var/www/html/public

  ## @param deployment.initContainerImage The image to use for the init container.
  ##
  initContainerImage: registry.codekoalas.com/devops/helm/koality-charts:init-mysql

  ## @param deployment.fcmSenderId The FCM Sender ID to use for the deployment.
  ##
  # fcmSenderId: 

  ## @param deployment.fcmServerKey The FCM Server Key to use for the deployment.
  ##
  # fcmServerKey:

  ## @param deployment.jwtSecret The JWT Secret if using JWT authentication tokens.
  ##
  # jwtSecret:

## The queue worker configuration. Defaults to calling queues for Redis.
## @TODO: Create a YAML structure for adding additional queue workers to the deployment.
queueWorker:
  enabled: false
  replicaCount: 1
  resources:
    limits:
      cpu: 150m
      memory: 750Mi
    requests:
      cpu: 50m
      memory: 250Mi

## A cron deployment for running cron in a container.
cron:
  enabled: false
  replicaCount: 1
  resources:
    limits:
      cpu: 100m
      memory: 500Mi
    requests:
      cpu: 50m
      memory: 100Mi

## Mail ConfigMap values.
mail:
  ## @param mail.mailer Specifies the mailer to use.
  ##  - values: smtp, sendmail, mailgun, mandrill, ses, sparkpost, log, array, mailtrap
  ##
  mailer: smtp

  ## @param mail.host The host to use for SMTP.
  ##
  host: mailhog.codekoalas.com

  ## @param mail.port The port to use for SMTP.
  ##
  port: 1025

  ## @param mail.username The username for use with the mailer.
  ##
  username: null

  ## @param mail.password The password for use with the mailer.
  ##
  password: null

  ## @param mail.encryption The encryption to use for SMTP.
  ##
  encryption: null

  ## @param mail.from The from address and name to use for SMTP.
  ##
  from:
    address: null
    name: null

## Laravel Pusher service.
pusher:
  ## @param pusher.appId The Pusher App ID.
  ##
  appId: null

  ## @param pusher.appKey The Pusher Key.
  ##
  appKey: null

  ## @param pusher.appSecret The Pusher Secret.
  ##
  appSecret: null

  ## @param pusher.appCluster The Pusher Cluster.
  ##
  appCluster: null

## Laravel MixPusher service.
mixpusher:
  ## @param mixpusher.appKey The MixPusher App key.
  ##
  appKey: null

  ## @param mixpusher.appCluster The MixPusher Cluster.
  ##
  appCluster: null

## Laravel Redis statefulset.
redis:
  ## @param redis.enabled Specifies whether a redis statefulset should be created.
  ##
  enabled: false

  ## @param redis.password The password to use for redis.
  ##
  password: password

  ## @param redis.port The port to use for redis.
  ##
  port: 6379

  ## @param redis.volumes The volumes to use for redis.
  ##
  volumes:
  - name: redis-aof
    mount:
      mountPath: /data
    claim:
      accessMode: ReadWriteMany
      size: 10Gi
      # If you want to use a custom storage class, you can specify `storageClass`. In this case, you need to create a storage class at first.
      # If `storageClass` is not specified, the behavior will vary per Kubernetes provider.
      # For example, GKE automatically chooses a default storage class and allocate a physical storage.
      # See https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes for more information.

# If the Laravel site uses an Echo Socket server.
echo:
  enabled: false
  image: registry.codekoalas.com/devops/helm/koality-charts:laravel-echo
  port: 6001
  limits:
    cpu: 200m
    memory: 500Mi
  requests:
    cpu: 50m
    memory: 250Mi

## AWS/Laravel configuration
aws:
  ## @param aws.region The AWS region to use.
  ##
  region: us-west-2
  s3:
    ## @param aws.s3.enabled If set to true, this will enable S3.
    ##
    enabled: false
    ## @param aws.s3.createNew If set to true, this will create an S3 bucket resource through a CRD.
    ##
    createNew: true
    ## @param aws.s3.bucketName The name of the S3 bucket to use.
    ##
    bucket: example-bucket
    ## @param aws.s3.url The url of the S3 bucket to use.
    ##
    url: "https://s3.us-west-2.amazonaws.com/example-bucket"
    ## @param aws.s3.usePathStyleEndpoint If set to true, this will use the path style endpoint for S3.
    ##
    usePathStyleEndpoint: true
    ## @param aws.s3.tagSets The tag sets to use for S3. See below for an example.
    ##
    tagSets:
      - key: "kubernetes.io/cluster/ck-autodevops-staging"
        value: "owned"
      - key: "kubernetes.io/cluster-service"
        value: "true"

# The HorizontalPodAutosacler
hpa:
  minReplicas: 1
  maxReplicas: 4

# The persistence image; for review apps this allows a DB to be created
# for use with this review.
persistence:
  enabled: true
  name: gitlab-autodevops-laravel
  databaseName: laravel
  databaseUser: laravel
  databasePassword: password
  replicaCount: 1
  limits:
    cpu: 500m
    memory: 500Mi
  requests:
    cpu: 250m
    memory: 250Mi
  volumes:
    - name: data
      mount:
        mountPath: /var/www/html/storage/app
        subPath: storage
        # subPath: "/pvc-mount/config.txt"
      claim:
        accessMode: ReadWriteMany
        size: 100Gi
        # If you want to use a custom storage class, you can specify `storageClass`. In this case, you need to create a storage class at first.
        # If `storageClass` is not specified, the behavior will vary per Kubernetes provider.
        # For example, GKE automatically chooses a default storage class and allocate a physical storage.
        # See https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes for more information.


# The service that is used with the Ingress.
service:
  enabled: true
  type: ClusterIP
  name: service-gitlab-autodevops-laravel
  url: "https://gitlab-autodevops-laravel.ckstage.site"
  extraHosts:
    - "test.gitlab-autodevops-laravel.ckstage.site"
  externalPort: 80
  internalPort: 80
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: nlb

# If we want to deploy an ingress class and what class name to use.
ingress:
  enabled: true
  className: nginx
  hostname: gitlab-autodevops-laravel.ckstage.site
  path: /
  tls:
    enabled: true
    acme: true
  modSecurity:
    enabled: false
    secRuleEngine: "DetectionOnly"
    # secRules:
    #   - variable: ""
    #     operator: ""
    #     action: ""
  canary:
    weight:
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    cert-manager.io/cluster-issuer: letsencrypt-prod

# Prometheus stuff
prometheus:
  metrics: false

livenessProbe:
  path: "/login"
  initialDelaySeconds: 15
  timeoutSeconds: 15
  scheme: "HTTP"
  probeType: "httpGet"
  httpHeaders: []
readinessProbe:
  path: "/login"
  initialDelaySeconds: 5
  timeoutSeconds: 3
  scheme: "HTTP"
  probeType: "httpGet"
  httpHeaders: []
startupProbe:
  enabled: false
  path: "/login"
  initialDelaySeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30
  periodSeconds: 10
  scheme: "HTTP"
  probeType: "httpGet"
  httpHeaders: []

